# 📒 算法笔记：轮流掷骰子的胜率 (Probability Game)

---

### 1. 题目大意

* 有 $n$ 个玩家轮流操作（顺序：$1 \to 2 \to \dots \to n \to 1 \to \dots$）。
* 每个人单次获胜的概率是 $p$。
* 只要有人获胜，游戏立即结束。
* **目标：** 求第 $i$ 个玩家获胜的概率。

---

### 2. 解题核心：无限等比数列

想让第 $i$ 个人赢，他可以在第 1 轮赢，也可以在第 2 轮赢……以此类推。

* **第 1 轮赢的概率：** 前面 $i-1$ 个人都失败，第 $i$ 个人成功。
    $$P_1 = (1-p)^{i-1} \cdot p$$
* **第 2 轮赢的概率：** 第 1 轮 $n$ 个人全失败，第 2 轮前面 $i-1$ 个人失败，第 $i$ 个人成功。
    $$P_2 = (1-p)^n \cdot (1-p)^{i-1} \cdot p$$
* **第 $m$ 轮赢的概率：** 前面经历了 $m-1$ 轮完整的失败。
    $$P_m = [(1-p)^n]^{m-1} \cdot (1-p)^{i-1} \cdot p$$

[Image of infinite geometric series sum formula]

---

### 3. 数学公式推导

总概率 $P$ 是所有轮次获胜概率之和，这构成了一个**无限递缩等比数列**：

* **首项 ($a_1$)：** $(1-p)^{i-1} \cdot p$
* **公比 ($q$)：** $(1-p)^n$ （即所有人转一圈都失败的概率）

根据求和公式 $S = \frac{a_1}{1-q}$，得到：
$$Ans = \frac{(1-p)^{i-1} \cdot p}{1 - (1-p)^n}$$

---

### 4. Python 参考代码

```python
import sys

def solve():
    # 1. 快速读入所有数据
    input_data = sys.stdin.read().split()
    if not input_data:
        return
    
    t = int(input_data[0])
    idx = 1
    for _ in range(t):
        n = int(input_data[idx])
        p = float(input_data[idx+1])
        i = int(input_data[idx+2])
        idx += 3
        
        # 2. 特判：如果获胜概率 p 为 0，谁都赢不了
        if p < 1e-9:
            print("0.0000")
            continue
        
        # 3. 计算等比数列参数
        q = 1 - p
        # a1: 第一轮获胜的概率
        first_term = (q ** (i - 1)) * p
        # r: 所有人失败一整轮的概率
        common_ratio = q ** n
        
        # 4. 无限等比数列求和
        result = first_term / (1 - common_ratio)
        
        # 5. 格式化输出保留4位小数
        print(f"{result:.4f}")

if __name__ == "__main__":
    solve()